<!DOCTYPE html>
<html>
    <head>
        <title>meepmeep</title>
        <link rel="icon" href="data:image/jpeg;base64,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" type="image/png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap">
        <style>
            * {
                box-sizing: border-box;
            }

            body, html {
                height: 100%;
                margin: 0;
                padding: 0;
                font-size: 1em;
                font-family: 'Poppins', sans-serif;
                background: #f5f5f5;
            }

            #title {
                text-align: center;
                font-size: 2.5em;
                margin: 20px;
                color: #555;
            }

            #notes {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .note {
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
                margin-bottom: 20px;
                padding: 20px;
                background-color: white;
                word-wrap: break-word;
                width: 90%;
            }

            .note-even {
                background-color: #f0f0f0;
            }

            .note-odd {
                background-color: #ffffff;
            }

            .note-header {
                color: #005cbf;  
                font-weight: bold;
                display: flex;
                justify-content: space-between;
                margin-bottom: 15px;
            }

            .date {
                text-align: right;
                color: #3392D6;  
                font-weight: bold;
            }
            
            .note-content {
                margin-top: 10px;
                color: #333;
                line-height: 1.6;
            }

            .note-image {
                max-width: 100%; /* This is to ensure the image is not larger than its container */
                height: auto; /* Maintain aspect ratio */
                border-radius: 5px;
            }
        </style>
    </head>

    <body>
        <div id="notes"></div>
        <script>
            let connection;
            let messageCount = 0;
            let relayServerUrl; 
            let isScrolledToBottom = true;
            let globalMessageCount = 0;

            window.addEventListener('resize', resizeImages);
            window.addEventListener('load', resizeImages);

            const notesElement = document.getElementById('notes');
            notesElement.addEventListener('scroll', () => {
                isScrolledToBottom = notesElement.scrollHeight - notesElement.scrollTop === notesElement.clientHeight;
            });

            function resizeImages() {
                let images = document.getElementsByClassName('note-image');
                for (let img of images) {
                    img.style.width = window.innerWidth / 3 + 'px';
                }
            }

            function generateGUID() {
                return 'xxxx-xxxx-xxxxxxxx'.replace(/[x]/g, function(c) {
                    var r = Math.random() * 16 | 0,
                        v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }

            function startWebSocket() {
                let buffer = [];
                let initialLoadFinished = false;
                // Only prompt the user for the relay server URL if it hasn't been set yet
                if (!relayServerUrl) {
                    relayServerUrl = prompt("Please enter the relay server URL:", "relay.damus.io");
                    if (relayServerUrl === null || relayServerUrl === "") {
                        relayServerUrl = "relay.damus.io";
                    }

                    // Validate the URL (only accept a-z, dashes, and periods)
                    let isValidUrl = /^[a-z0-9-.]+$/i.test(relayServerUrl);
                    if (!isValidUrl) {
                        alert("Invalid URL. Only a-z, 0-9, dashes, and periods are allowed.");
                        return;
                    }

                    // Add "wss://" if it's not there
                    if (!relayServerUrl.startsWith("wss://")) {
                        relayServerUrl = "wss://" + relayServerUrl;
                    }
                }

                connection = new WebSocket(relayServerUrl);

                connection.onopen = () => {
                    const twoDaysAgo = Math.floor(Date.now() / 1000) - (2 * 24 * 60 * 60);
                    const subscriptionId = 'meepmeep-' + generateGUID();  // using generated GUID here
                    const filters = { kinds: [1], since: twoDaysAgo };
                    connection.send(JSON.stringify(['REQ', subscriptionId, filters]));
                };

                connection.onmessage = (message) => {
                    const data = JSON.parse(message.data);
                    const [type, subscriptionId, event] = data;

                    if (type === 'EVENT') {
                        if (!initialLoadFinished) {
                            // Add event to buffer during initial load
                            buffer.push(event);
                        } else {
                            // Display event immediately after initial load
                            displayEvent(event);
                        }
                    } else if (type === 'EOSE' && !initialLoadFinished) {
                        // Sort buffer, render all events, mark initial load as finished, and empty buffer
                        buffer.sort((a, b) => a.created_at - b.created_at);
                        for (const event of buffer) {
                            if (messageCount >= 500) break;
                            displayEvent(event);
                            messageCount++;
                        }
                        initialLoadFinished = true;
                        buffer = [];
                    }
                };

                connection.onclose = () => {
                    setTimeout(startWebSocket, 1000);
                };

                connection.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    connection.close(); // Close the connection and trigger onclose
                };
            };

            function displayEvent(event) {
                console.log("New event received", event);
                const noteElement = document.createElement('div');
                noteElement.className = 'note';
                let formattedDate = new Date(event.created_at * 1000).toLocaleString("en-US", { month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true });
                let formattedAuthor = `${event.pubkey.substring(0, 8)}:${event.pubkey.slice(-8)}`;
                let formattedContent = event.content;

                // Determine the note's class based on the global message count
                const noteClass = globalMessageCount % 2 === 0 ? 'note-even' : 'note-odd';
                noteElement.classList.add(noteClass);
                globalMessageCount++;

                let urlPattern = /(https?:\/\/[^\s]+)/g;
                formattedContent = formattedContent.replace(urlPattern, function(url) {
                    if (/\.(jpeg|jpg|gif|png|bmp|webp|tiff)$/i.test(url)) {
                        return `<br><img class="note-image" src="${url}" alt="Image"/><br>`;
                    } else if (/\.mp3$/i.test(url)) {
                        return `<br><audio controls><source src="${url}" type="audio/mpeg">Your browser does not support the audio tag.</audio><br>`;
                    } else if (/\.(mp4|mov|avi)$/i.test(url)) {
                        return `<br><video width="320" height="240" controls><source src="${url}" type="video/mp4">Your browser does not support the video tag.</video><br>`;
                    } else {
                        return `<a href="${url}" target="_blank">${url}</a>`;
                    }
                });

                noteElement.innerHTML = `
                     <div class="note-header">
                         <div class="author">${formattedAuthor}</div>
                         <div class="date">${formattedDate}</div>
                     </div>
                     <div class="note-content">${formattedContent}</div>
                `;
                
                const notesElement = document.getElementById('notes');

                // Always append the event to the notesElement
                notesElement.append(noteElement);

                resizeImages();  // Resize images after appending a new note

                // Check if there are more than 500 notes, and if so, remove the oldest one
                while (notesElement.children.length > 500) {
                    notesElement.removeChild(notesElement.firstChild);
                }

                // Only scroll to the bottom if the user has not scrolled up to view older messages
                if (isScrolledToBottom) {
                    notesElement.scrollTop = notesElement.scrollHeight;
                }

                // Reset the title if the user scrolls to the bottom
                if (isScrolledToBottom && document.title === "***meepmeep") {
                    document.title = "meepmeep";
                }
            }

            startWebSocket();
        </script>
    </body>
</html>